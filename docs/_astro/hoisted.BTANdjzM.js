const d=new URLSearchParams(location.search),L=new Set((d.get("types")??"blog,saved,bluesky,release").split(",").filter(Boolean));document.querySelectorAll('input[name="type"]').forEach(t=>{const e=t;e.checked=L.has(e.value),e.addEventListener("change",()=>{const n=Array.from(document.querySelectorAll('input[name="type"]')).map(o=>o).filter(o=>o.checked).map(o=>o.value);d.set("types",n.join(",")),history.replaceState({},"",`?${d.toString()}`),document.dispatchEvent(new CustomEvent("filters:changed",{detail:{types:n}}))})});const g=new URLSearchParams(location.search),y=(g.get("types")??"").split(",").filter(Boolean);function b(){const t=new Set(y.length?y:Array.from(document.querySelectorAll('input[name="type"]')).map(e=>e.value));document.querySelectorAll(".row").forEach(e=>{const n=e.dataset.type;e.style.display=t.has(n)?"":"none"})}b();document.addEventListener("filters:changed",t=>{const e=new Set(t.detail.types);document.querySelectorAll(".row").forEach(n=>{const o=n.dataset.type;n.style.display=e.has(o)?"":"none"})});const p=document.getElementById("detail-panel"),s=document.getElementById("panel-content"),f=document.getElementById("panel-title"),c=document.getElementById("panel-close"),m=document.getElementById("panel-backdrop"),r=()=>window.innerWidth<=980,w=s.innerHTML;function v(t=!0){t&&r()?document.body.style.overflow="hidden":document.body.style.overflow=""}async function E(t){try{const n=await(await fetch(t)).text(),a=new DOMParser().parseFromString(n,"text/html"),l=a.querySelector("article")||a.querySelector("main")||a.querySelector(".content");return l?l.innerHTML:"<p>Unable to load content</p>"}catch{return"<p>Error loading content</p>"}}async function S(t){const e=window.__TIMELINE__.find(a=>a.id===t);if(!e)return;r()?(m.removeAttribute("hidden"),p.classList.add("mobile-open"),c.removeAttribute("hidden"),v(!0)):c.setAttribute("hidden",""),f.textContent="Details",s.innerHTML="<p>Loading...</p>";let n="";if(e.type==="blog"){const a=`/blog/${e.id.replace("blog:","")}`,l=await E(a);n=`<div class="detail-meta">${e.type.toUpperCase()} · ${new Date(e.timestamp).toLocaleString()}</div>
        <h3 class="detail-title">${e.title||""}</h3>
        <div class="detail-content">${l}</div>`}else n=`<div class="detail-meta">${e.type.toUpperCase()} · ${new Date(e.timestamp).toLocaleString()}</div>
        <h3 class="detail-title">${e.title||""}</h3>
        <div class="detail-content">${e.content_html||`<p>${e.summary||""}</p>`}</div>
        ${e.url?`<a href="${e.url}" target="_blank" rel="noopener" class="detail-link">Open source ↗</a>`:""}`;s.innerHTML=n;const o=new URLSearchParams(location.search);o.set("id",t),history.replaceState({},"",`?${o.toString()}`)}function u(){r()&&(m.setAttribute("hidden",""),p.classList.remove("mobile-open"),v(!1)),f.textContent="About",s.innerHTML=w,c.setAttribute("hidden","");const t=new URLSearchParams(location.search);t.delete("id"),history.replaceState({},"",`?${t.toString()}`)}c.addEventListener("click",u);m.addEventListener("click",u);document.addEventListener("keydown",t=>{t.key==="Escape"&&(r()?p.classList.contains("mobile-open"):s.innerHTML!==w)&&u()});document.querySelectorAll(".card").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),S(t.dataset.id)})});const i=document.getElementById("tooltip"),$=i.querySelector(".tooltip-title"),A=i.querySelector(".tooltip-meta");function M(t){const n=Math.min(window.innerHeight-80,Math.max(0,t.top+window.scrollY+10)),o=Math.min(window.innerWidth-380,Math.max(0,t.left+window.scrollX+10));i.style.top=`${n}px`,i.style.left=`${o}px`}function k(t){const e=t.dataset.timestamp,n=t.dataset.dotType,o=new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),l={blog:"📝",saved:"🔖",bluesky:"🦋",release:"🏷️"}[n]||"";$.textContent=`${l} ${n.toUpperCase()}`,A.textContent=o,M(t.getBoundingClientRect()),i.removeAttribute("hidden")}function T(){i.setAttribute("hidden","")}document.querySelectorAll(".dot").forEach(t=>{const e=t;e.addEventListener("mouseenter",()=>k(e)),e.addEventListener("mouseleave",T)});const h=g.get("id");h&&S(h);
