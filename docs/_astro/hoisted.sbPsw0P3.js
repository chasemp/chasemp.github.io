const d=new URLSearchParams(location.search),T=new Set((d.get("types")??"blog,saved,bluesky,release").split(",").filter(Boolean));document.querySelectorAll('input[name="type"]').forEach(t=>{const e=t;e.checked=T.has(e.value),e.addEventListener("change",()=>{const n=Array.from(document.querySelectorAll('input[name="type"]')).map(o=>o).filter(o=>o.checked).map(o=>o.value);d.set("types",n.join(",")),history.replaceState({},"",`?${d.toString()}`),document.dispatchEvent(new CustomEvent("filters:changed",{detail:{types:n}}))})});const v=new URLSearchParams(location.search),y=(v.get("types")??"").split(",").filter(Boolean);function M(){const t=new Set(y.length?y:Array.from(document.querySelectorAll('input[name="type"]')).map(e=>e.value));document.querySelectorAll(".row").forEach(e=>{const n=e.dataset.type;e.style.display=t.has(n)?"":"none"})}M();document.addEventListener("filters:changed",t=>{const e=new Set(t.detail.types);document.querySelectorAll(".row").forEach(n=>{const o=n.dataset.type;n.style.display=e.has(o)?"":"none"})});const p=document.getElementById("detail-panel"),l=document.getElementById("panel-content"),w=document.getElementById("panel-title"),s=document.getElementById("panel-close"),u=document.getElementById("panel-backdrop"),c=()=>window.innerWidth<=980,b=l.innerHTML;function L(t=!0){t&&c()?document.body.style.overflow="hidden":document.body.style.overflow=""}async function C(t){try{const n=await(await fetch(t)).text(),a=new DOMParser().parseFromString(n,"text/html"),r=a.querySelector("article")||a.querySelector("main")||a.querySelector(".content");return r?r.innerHTML:"<p>Unable to load content</p>"}catch{return"<p>Error loading content</p>"}}async function S(t){const e=window.__TIMELINE__.find(a=>a.id===t);if(!e)return;c()?(u.removeAttribute("hidden"),p.classList.add("mobile-open"),s.removeAttribute("hidden"),L(!0)):s.setAttribute("hidden",""),w.textContent="Details",l.innerHTML="<p>Loading...</p>";let n="";if(e.type==="blog"){const a=`/blog/${e.id.replace("blog:","")}`,r=await C(a);n=`<div class="detail-meta">${e.type.toUpperCase()} · ${new Date(e.timestamp).toLocaleString()}</div>
        <h3 class="detail-title">${e.title||""}</h3>
        <div class="detail-content">${r}</div>`}else n=`<div class="detail-meta">${e.type.toUpperCase()} · ${new Date(e.timestamp).toLocaleString()}</div>
        <h3 class="detail-title">${e.title||""}</h3>
        <div class="detail-content">${e.content_html||`<p>${e.summary||""}</p>`}</div>
        ${e.url?`<a href="${e.url}" target="_blank" rel="noopener" class="detail-link">Open source ↗</a>`:""}`;l.innerHTML=n;const o=new URLSearchParams(location.search);o.set("id",t),history.replaceState({},"",`?${o.toString()}`)}function m(){c()&&(u.setAttribute("hidden",""),p.classList.remove("mobile-open"),L(!1)),w.textContent="About",l.innerHTML=b,s.setAttribute("hidden","");const t=new URLSearchParams(location.search);t.delete("id"),history.replaceState({},"",`?${t.toString()}`)}s.addEventListener("click",m);u.addEventListener("click",m);document.addEventListener("keydown",t=>{t.key==="Escape"&&(c()?p.classList.contains("mobile-open"):l.innerHTML!==b)&&m()});document.querySelectorAll(".card").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),S(t.dataset.id)})});const i=document.getElementById("tooltip"),E=i.querySelector(".tooltip-title"),A=i.querySelector(".tooltip-meta");function $(t){const n=Math.min(window.innerHeight-80,Math.max(0,t.top+window.scrollY+10)),o=Math.min(window.innerWidth-380,Math.max(0,t.left+window.scrollX+10));i.style.top=`${n}px`,i.style.left=`${o}px`}function h(t){const e=t.dataset.id,n=window.__TIMELINE__.find(a=>a.id===e);if(!n)return;t.setAttribute("aria-describedby","tooltip"),E.textContent=n.title||"";const o=new Date(n.timestamp).toLocaleString();A.textContent=`${n.type} · ${o}`,$(t.getBoundingClientRect()),i.removeAttribute("hidden")}function f(t){t.removeAttribute("aria-describedby"),i.setAttribute("hidden","")}document.querySelectorAll(".card").forEach(t=>{const e=t;e.addEventListener("mouseenter",()=>h(e)),e.addEventListener("mouseleave",()=>f(e)),e.addEventListener("focus",()=>h(e)),e.addEventListener("blur",()=>f(e))});function k(t){const e=t.dataset.timestamp,n=t.dataset.dotType,o=new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});E.textContent=n.toUpperCase(),A.textContent=o,$(t.getBoundingClientRect()),i.removeAttribute("hidden")}function q(){i.setAttribute("hidden","")}document.querySelectorAll(".dot").forEach(t=>{const e=t;e.addEventListener("mouseenter",()=>k(e)),e.addEventListener("mouseleave",q)});const g=v.get("id");g&&S(g);
