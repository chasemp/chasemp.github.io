const p=new URLSearchParams(location.search),b=new Set((p.get("types")??"blog,saved,bluesky,release,wikipedia").split(",").filter(Boolean)),r=document.querySelectorAll('input[name="type"]');r.forEach(e=>{e.checked=b.has(e.value),e.addEventListener("change",m)});function m(){const e=Array.from(r).filter(t=>t.checked).map(t=>t.value);p.set("types",e.join(",")),history.replaceState({},"",`?${p.toString()}`),document.dispatchEvent(new CustomEvent("filters:changed",{detail:{types:e}}))}document.getElementById("select-all")?.addEventListener("click",()=>{r.forEach(e=>e.checked=!0),m()});document.getElementById("select-none")?.addEventListener("click",()=>{r.forEach(e=>e.checked=!1),m()});const w=new URLSearchParams(location.search),f=(w.get("types")??"").split(",").filter(Boolean);function k(){const e=new Set(f.length?f:Array.from(document.querySelectorAll('input[name="type"]')).map(t=>t.value));document.querySelectorAll(".row").forEach(t=>{const n=t.dataset.type;t.style.display=e.has(n)?"":"none"})}k();document.addEventListener("filters:changed",e=>{const t=new Set(e.detail.types);document.querySelectorAll(".row").forEach(n=>{const o=n.dataset.type;n.style.display=t.has(o)?"":"none"})});const u=document.getElementById("detail-panel"),c=document.getElementById("panel-content"),v=document.getElementById("panel-title"),s=document.getElementById("panel-close"),h=document.getElementById("panel-backdrop"),d=()=>window.innerWidth<=980,E=c.innerHTML;function S(e=!0){e&&d()?document.body.style.overflow="hidden":document.body.style.overflow=""}async function $(e){try{const n=await(await fetch(e)).text(),a=new DOMParser().parseFromString(n,"text/html"),l=a.querySelector("article")||a.querySelector("main")||a.querySelector(".content");return l?l.innerHTML:"<p>Unable to load content</p>"}catch{return"<p>Error loading content</p>"}}async function L(e){const t=window.__TIMELINE__.find(a=>a.id===e);if(!t)return;d()?(h.removeAttribute("hidden"),u.classList.add("mobile-open"),s.removeAttribute("hidden"),S(!0)):s.setAttribute("hidden",""),v.textContent="Details",c.innerHTML="<p>Loading...</p>";let n="";if(t.type==="blog"){const a=`/blog/${t.id.replace("blog:","")}`,l=await $(a);n=`<div class="detail-meta">${t.type.toUpperCase()} · ${new Date(t.timestamp).toLocaleString()}</div>
        <h3 class="detail-title">${t.title||""}</h3>
        <div class="detail-content">${l}</div>`}else n=`<div class="detail-meta">${t.type.toUpperCase()} · ${new Date(t.timestamp).toLocaleString()}</div>
        <h3 class="detail-title">${t.title||""}</h3>
        <div class="detail-content">${t.content_html||`<p>${t.summary||""}</p>`}</div>
        ${t.url?`<a href="${t.url}" target="_blank" rel="noopener" class="detail-link">Source ↗</a>`:""}`;c.innerHTML=n;const o=new URLSearchParams(location.search);o.set("id",e),history.replaceState({},"",`?${o.toString()}`)}function y(){d()&&(h.setAttribute("hidden",""),u.classList.remove("mobile-open"),S(!1)),v.textContent="About",c.innerHTML=E,s.setAttribute("hidden","");const e=new URLSearchParams(location.search);e.delete("id"),history.replaceState({},"",`?${e.toString()}`)}s.addEventListener("click",y);h.addEventListener("click",y);document.addEventListener("keydown",e=>{e.key==="Escape"&&(d()?u.classList.contains("mobile-open"):c.innerHTML!==E)&&y()});document.querySelectorAll(".card").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),L(e.dataset.id)})});const i=document.getElementById("tooltip"),M=i.querySelector(".tooltip-title"),A=i.querySelector(".tooltip-meta");function T(e){const n=Math.min(window.innerHeight-80,Math.max(0,e.top+window.scrollY+10)),o=Math.min(window.innerWidth-380,Math.max(0,e.left+window.scrollX+10));i.style.top=`${n}px`,i.style.left=`${o}px`}function B(e){const t=e.dataset.timestamp,n=e.dataset.dotType,o=new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),l={blog:"📝",saved:"🔖",bluesky:"🦋",release:"🏷️",wikipedia:"🌐"}[n]||"";M.textContent=`${l} ${n.toUpperCase()}`,A.textContent=o,T(e.getBoundingClientRect()),i.removeAttribute("hidden")}function q(){i.setAttribute("hidden","")}document.querySelectorAll(".dot").forEach(e=>{const t=e;t.addEventListener("mouseenter",()=>B(t)),t.addEventListener("mouseleave",q)});const g=w.get("id");g&&L(g);
